
<!DOCTYPE html>
<html lang="hr" class="h-100" xmlns:th="https://thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head th:replace="fragments/general :: head"></head>
<head>
    <meta charset="UTF-8">
    <title>Filtriranje jela</title>
    <link href="../static/css/style.css" th:href="@{/css/style.css}" rel="stylesheet" />
    <link href="../static/css/experiment.css" th:href="@{/css/experiment.css}" rel="stylesheet" />
    <link href="../static/css/test.css" th:href="@{/css/test.css}" rel="stylesheet" />

</head>
<body>
<main role="main" class="flex-shrink-0" style="margin-bottom: 125px;">
    <header th:replace="fragments/general :: header"></header>
</main>

    <div class="container card-container">
        <div class="menu">
            <div class="menu-group">
                <th:block th:each="foodItem: ${menu}">
                    <button class="menu-item blob" th:id="'btnItem_'+${foodItem.getId()}">
                        <img id = "test" class="menu-item-image" th:src="@{'/'+${foodItem.getImage()}}">
                        <div class="menu-item-text">
                            <h3 class="menu-item-heading">
                                <span class="menu-item-name">[[${foodItem.getName()}]] iz restorana [[${foodItem.getRestaurant().getName()}]]</span>
                                <th:block th:each="portion: ${foodItem.getPortions()}">
                                <span th:if="${portion.isChecked()}">
                                  <span class="menu-item-price">
                                      <a style="background: #34d534; min-width: 5rem; text-align: center;" class="cd-add-to-cart js-cd-add-to-cart" th:item-id="${foodItem.getId()}"
                                         onclick="lookUpMeal(this.getAttribute('item-id'))">[[${portion.getPrice()}]]KM</a>
                                  </span>
                                </span>
                                </th:block>
                            </h3>
                            <h4 class="menu-item-info">
                                [[${foodItem.getInfo()}]]
                            </h4>
                        </div>

                    </button>
                </th:block>
            </div>
        </div>
    </div>

<footer th:replace="fragments/general :: footer">
</footer>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous">
</script>

<script th:inline="javascript">

    function printImgUrl(){
        console.log(document.getElementById("test").src);
    }
    window.onload=printImgUrl;

    function lookUpMeal(itemId){
        console.log("ITEMID: " + itemId);
        $(function () {
            $.ajax({
                url: `/izaberi?jelo=${itemId}`,
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                },
                success: function (data) {
                    console.log("AJAX SUCCESS: " + data);
                    window.location.href = window.location.protocol + "//" + window.location.host + "/" + data.path;
                },
                error: function (data) {
                    console.log("AJAX ERROR: " + data);
                }
            });
        });
    }
</script>
</body>
</html>